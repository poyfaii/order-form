<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏î‡∏≠‡∏ô‡πÇ‡∏≠‡∏ó‡∏≠‡∏õ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- Firebase SDKs -->
  <script type="module">
    // Import Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
    import { getDatabase, ref, push, set, get, child } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCDAaW-OyL_13qkF7sCxXkMhpJyrOtntjg",
      authDomain: "orders-3d979.firebaseapp.com",
      databaseURL: "https://orders-3d979-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "orders-3d979",
      storageBucket: "orders-3d979.appspot.com",
      messagingSenderId: ". ",
      appId: "1:. :web:4f1b772b853b602cc93e94",
      measurementId: "G-P5JPR90CX8"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // Expose functions to global scope
    window.saveOrderToFirebase = async function(order) {
      try {
        const ordersRef = ref(database, 'orders');
        const newOrderRef = push(ordersRef);
        await set(newOrderRef, order);
        return true;
      } catch (error) {
        console.error("Error saving order:", error);
        return false;
      }
    }

    window.getOrdersFromFirebase = async function() {
      try {
        const dbRef = ref(database);
        const snapshot = await get(child(dbRef, 'orders'));
        if (snapshot.exists()) {
          return snapshot.val();
        } else {
          return {};
        }
      } catch (error) {
        console.error("Error getting orders:", error);
        return {};
      }
    }

    window.updateOrderInFirebase = async function(orderId, updatedOrder) {
      try {
        const orderRef = ref(database, `orders/${orderId}`);
        await set(orderRef, updatedOrder);
        return true;
      } catch (error) {
        console.error("Error updating order:", error);
        return false;
      }
    }

    window.deleteOrderFromFirebase = async function(orderId) {
      try {
        const orderRef = ref(database, `orders/${orderId}`);
        await set(orderRef, null);
        return true;
      } catch (error) {
        console.error("Error deleting order:", error);
        return false;
      }
    }
  </script>

  <style>
    @media print {
  body * {
    visibility: hidden;
  }
  #receiptFullPage, #receiptFullPage * {
    visibility: visible;
  }
  #receiptFullPage {
    position: absolute;
    left: 0;
    top: 0;
    width: 100% !important;
    max-width: none !important;
    padding: 0 !important;
    margin: 0 auto !important;
    zoom: 1.2; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏ß‡∏•‡∏≤ print */
  }
}
  </style>
</head>
<body class="bg-yellow-50 text-gray-800 font-sans">

  <!-- Login Button -->
  <div class="fixed top-4 right-4 z-50">
    <button id="loginBtn" onclick="showLoginModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow-md text-sm">
      üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
    </button>
    <button id="logoutBtn" onclick="logout()" class="hidden bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg shadow-md text-sm">
      üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    </button>
  </div>

  <!-- Login Modal -->
  <div id="loginModal" class="hidden fixed inset-0 bg-gradient-to-br from-yellow-400 via-orange-400 to-red-400 bg-opacity-95 flex items-center justify-center z-50 p-4">
    <div class="bg-white p-6 sm:p-8 rounded-3xl shadow-2xl w-full max-w-sm transform transition-all duration-300 animate-pulse">
      <div class="text-center mb-6">
        <div class="bg-gradient-to-r from-yellow-400 to-orange-500 w-16 h-16 sm:w-20 sm:h-20 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg animate-bounce">
          <span class="text-2xl sm:text-3xl">üçå</span>
        </div>
        <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-2">‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏î‡∏≠‡∏ô‡πÇ‡∏≠‡∏ó‡∏≠‡∏õ</h2>
        <p class="text-sm text-gray-600">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</p>
      </div>
      
      <div class="space-y-4">
        <div class="relative">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <span class="text-gray-400 text-lg">üîê</span>
          </div>
          <input id="passwordInput" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full pl-12 pr-4 py-4 text-lg border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400 transition-all duration-200" onkeypress="handlePasswordKeyPress(event)" />
        </div>
        
        <div class="space-y-3">
          <button onclick="login()" class="w-full bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-4 text-lg rounded-xl shadow-lg transition-all duration-200 transform hover:scale-105 active:scale-95">
            üîì ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
          </button>
          <button onclick="hideLoginModal()" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 rounded-xl shadow-md transition-all duration-200">
            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
          </button>
        </div>
      </div>
      
      
    </div>
  </div>

  <!-- Order Details Modal -->
  <div id="orderModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-96 overflow-y-auto">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold">üìÑ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
        <button onclick="hideOrderModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
      </div>
      <div id="orderDetails"></div>
      <div id="orderActions" class="mt-4 flex gap-2"></div>
    </div>
  </div>

  <!-- Edit Order Modal -->
  <div id="editOrderModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-xl shadow-xl max-w-lg w-full mx-4 max-h-96 overflow-y-auto">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
        <button onclick="hideEditOrderModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
      </div>
      <div id="editOrderForm"></div>
    </div>
  </div>

  <!-- Edit Current Order Modal -->
  <div id="editCurrentOrderModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-xl shadow-xl max-w-lg w-full mx-4 max-h-96 overflow-y-auto">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h2>
        <button onclick="hideEditCurrentOrderModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
      </div>
      <div id="editCurrentOrderForm"></div>
    </div>
  </div>

  <!-- Main Order Form -->
  <div id="mainOrderForm" class="max-w-4xl mx-auto p-3 sm:p-6 space-y-4 sm:space-y-6">
    <div class="text-center mb-6">
      <h1 class="text-2xl sm:text-3xl font-extrabold text-yellow-700 mb-2">üçå ‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏î‡∏≠‡∏ô‡πÇ‡∏≠‡∏ó‡∏≠‡∏õ</h1>
      
    </div>

    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ -->
    <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6 space-y-4 border-2 border-yellow-200">
      <div class="flex items-center gap-2 mb-4">
        <span class="text-2xl">üë§</span>
        <h2 class="text-lg sm:text-xl font-bold text-gray-800">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2>
      </div>
      <div class="space-y-3">
        <input id="customerName" class="w-full border-2 border-yellow-300 p-4 text-base rounded-xl focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400 transition-all" placeholder="üë§ ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" />
        <input id="customerPhone" 
       type="tel"
       inputmode="numeric"
       pattern="[0-9]*"
       maxlength="10"
       class="w-full border-2 border-yellow-300 p-4 text-base rounded-xl focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400 transition-all" 
       placeholder="üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" 
       oninput="this.value = this.value.replace(/[^0-9]/g, '')" />
        <textarea id="customerAddress" rows="3" class="w-full border-2 border-yellow-300 p-4 text-base rounded-xl focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400 transition-all resize-none" placeholder="üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á"></textarea>
      </div>
    </div>

    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
    <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6 space-y-4 border-2 border-green-200">
      <div class="flex items-center gap-2 mb-4">
        <span class="text-2xl">üçØ</span>
        <h2 class="text-lg sm:text-xl font-bold text-gray-800">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
      </div>
      <div class="space-y-3">
        <input id="productName" class="w-full border-2 border-green-300 p-4 text-base rounded-xl focus:ring-2 focus:ring-green-400 focus:border-green-400 transition-all" placeholder="üçå ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" />
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <input id="productSize" class="w-full border-2 border-green-300 p-4 text-base rounded-xl focus:ring-2 focus:ring-green-400 focus:border-green-400 transition-all" placeholder="üìè ‡∏Ç‡∏ô‡∏≤‡∏î (‡∏Å‡∏£‡∏±‡∏°)" />
          <input id="productQty" type="number" min="1" class="w-full border-2 border-green-300 p-4 text-base rounded-xl focus:ring-2 focus:ring-green-400 focus:border-green-400 transition-all" placeholder="üî¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" />
        </div>
        <input id="productPrice" type="number" min="0" step="0.01" class="w-full border-2 border-green-300 p-4 text-base rounded-xl focus:ring-2 focus:ring-green-400 focus:border-green-400 transition-all" placeholder="üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)" />
        <button onclick="addItem()" class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 text-lg rounded-xl shadow-lg transition-all duration-200 transform hover:scale-105 active:scale-95">
          ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        </button>
      </div>
    </div>

    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
    <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6 space-y-4 border-2 border-blue-200">
      <div class="flex items-center gap-2 mb-4">
        <span class="text-2xl">üõí</span>
        <h2 class="text-lg sm:text-xl font-bold text-gray-800">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
      </div>
      <ul id="itemList" class="space-y-3"></ul>
      <div class="border-t-2 border-gray-200 pt-4 mt-4">
        <div class="bg-gradient-to-r from-blue-50 to-green-50 p-4 rounded-xl">
          <p class="text-center text-gray-800 font-bold text-lg sm:text-xl">
            ‡∏£‡∏ß‡∏°: <span id="totalQty" class="text-blue-600">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ | 
            <span id="totalPrice" class="text-green-600">0.00</span> ‡∏ö‡∏≤‡∏ó
          </p>
        </div>
      </div>
    </div>

    <!-- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå -->
    <div class="bg-gradient-to-br from-orange-50 to-yellow-50 rounded-2xl shadow-lg p-4 sm:p-6 space-y-4 border-2 border-orange-200">
      <div class="text-center mb-6">
        <div class="bg-gradient-to-r from-orange-400 to-yellow-500 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
          <span class="text-2xl">üîç</span>
        </div>
        <h2 class="text-lg sm:text-xl font-bold text-gray-800 mb-2">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
        <p class="text-sm text-gray-600">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</p>
      </div>
      
      <div class="space-y-4">
        <div class="relative">
          <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
            <span class="text-orange-400 text-lg">üîç</span>
          </div>
          <input id="searchInput" class="w-full pl-12 pr-4 py-4 text-base border-2 border-orange-300 rounded-xl focus:ring-2 focus:ring-orange-400 focus:border-orange-400 transition-all bg-white shadow-sm" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" onkeypress="handleSearchKeyPress(event)" />
        </div>
        
        <button onclick="searchOrders()" class="w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-bold py-4 text-lg rounded-xl shadow-lg transition-all duration-200 transform hover:scale-105 active:scale-95">
          üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå
        </button>
        
        <button onclick="clearSearch()" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 text-base rounded-xl shadow-md transition-all duration-200">
          üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
        </button>
      </div>
      
      <!-- Search Results -->
      <div id="searchResults" class="hidden mt-6">
        <div class="border-t-2 border-orange-200 pt-6">
          <div class="flex items-center gap-2 mb-4">
            <span class="text-xl">üìã</span>
            <h3 class="text-lg font-bold text-gray-800">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h3>
            <span id="searchCount" class="bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-sm font-medium"></span>
          </div>
          <div id="searchResultsList" class="space-y-3"></div>
        </div>
      </div>
    </div>

    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ -->
    <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6 space-y-4 border-2 border-purple-200">
      <div class="flex items-center gap-2 mb-4">
        <span class="text-2xl">‚ö°</span>
        <h2 class="text-lg sm:text-xl font-bold text-gray-800">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h2>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <button onclick="generateReceipt()" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-4 px-4 text-base rounded-xl shadow-lg transition-all duration-200 transform hover:scale-105 active:scale-95">
          üìÑ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à
        </button>
        <button onclick="showEditCurrentOrder()" class="bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-bold py-4 px-4 text-base rounded-xl shadow-lg transition-all duration-200 transform hover:scale-105 active:scale-95">
          ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå
        </button>
        <button onclick="saveOrder()" class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-4 px-4 text-base rounded-xl shadow-lg transition-all duration-200 transform hover:scale-105 active:scale-95">
          üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå
        </button>
        <button onclick="clearAll()" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-4 px-4 text-base rounded-xl shadow-lg transition-all duration-200 transform hover:scale-105 active:scale-95">
          üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        </button>
      </div>
    </div>

    <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
    <div id="statusMessage" class="hidden p-4 rounded-xl text-center font-semibold text-base"></div>
  </div>

  <!-- Admin Dashboard -->
  <div id="adminDashboard" class="hidden max-w-6xl mx-auto p-3 sm:p-6 space-y-4 sm:space-y-6">
    <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
      <div class="text-center sm:text-left">
        <h1 class="text-2xl sm:text-3xl font-extrabold text-yellow-700">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
        <p class="text-sm sm:text-base text-gray-600">‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏î‡∏≠‡∏ô‡πÇ‡∏≠‡∏ó‡∏≠‡∏õ</p>
      </div>
      <button onclick="refreshOrders()" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-3 rounded-xl shadow-lg transition-all duration-200 transform hover:scale-105 active:scale-95">
        üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
      </button>
    </div>

    <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-2xl shadow-lg p-5 border-2 border-green-200">
        <div class="flex items-center gap-2 mb-3">
          <span class="text-2xl">üìà</span>
          <h3 class="text-lg font-bold text-green-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</h3>
        </div>
        <p class="text-2xl sm:text-3xl font-bold text-green-600" id="totalRevenue">0 ‡∏ö‡∏≤‡∏ó</p>
      </div>
      <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl shadow-lg p-5 border-2 border-blue-200">
        <div class="flex items-center gap-2 mb-3">
          <span class="text-2xl">üì¶</span>
          <h3 class="text-lg font-bold text-blue-700">‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        </div>
        <p class="text-2xl sm:text-3xl font-bold text-blue-600" id="totalOrders">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
      </div>
      <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl shadow-lg p-5 border-2 border-purple-200">
        <div class="flex items-center gap-2 mb-3">
          <span class="text-2xl">üìÖ</span>
          <h3 class="text-lg font-bold text-purple-700">‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
        </div>
        <p class="text-2xl sm:text-3xl font-bold text-purple-600" id="todayOrders">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
      </div>
    </div>

    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå -->
    <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6 border-2 border-yellow-200">
      <div class="flex items-center gap-2 mb-4">
        <span class="text-2xl">üìã</span>
        <h2 class="text-xl font-bold text-gray-800">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
      </div>
      <div id="ordersList" class="space-y-3"></div>
    </div>
  </div>

<!-- ‚úÖ ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà -->
<div id="receiptFullPage" class="hidden w-full sm:max-w-lg mx-auto bg-white p-6 sm:p-8 shadow-lg border rounded-2xl relative overflow-hidden text-gray-800 font-sans">
  <!-- ‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥ -->
  <div class="absolute inset-0 flex items-center justify-center opacity-5 pointer-events-none select-none z-0">
    <h1 class="text-6xl font-bold rotate-12 text-gray-400 whitespace-nowrap">‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏î‡∏≠‡∏ô‡πÇ‡∏≠‡∏ó‡∏≠‡∏õ</h1>
  </div>

  <div class="relative z-10 space-y-6">
    <!-- ‡∏´‡∏±‡∏ß‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à -->
    <div class="text-center space-y-1">
      <h1 class="text-2xl font-bold text-yellow-700">üçå ‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏î‡∏≠‡∏ô‡πÇ‡∏≠‡∏ó‡∏≠‡∏õ</h1>
      <p class="text-sm text-gray-600">‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</p>
      <p class="text-xs text-gray-500" id="receiptDate"></p>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ -->
    <div class="bg-yellow-50 p-4 rounded-xl shadow-sm border border-yellow-200 space-y-1 text-sm">
      <p><strong>üë§ ‡∏ä‡∏∑‡πà‡∏≠:</strong> <span id="receiptCustomerName"></span></p>
      <p><strong>üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</strong> <span id="receiptCustomerPhone"></span></p>
      <p><strong>üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> <span id="receiptCustomerAddress"></span></p>
    </div>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
    <table class="w-full text-sm border-t border-b border-gray-300">
      <thead class="bg-yellow-100 text-gray-800">
        <tr>
          <th class="text-left py-2 px-2">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
          <th class="text-center py-2 px-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
          <th class="text-right py-2 px-2">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
        </tr>
      </thead>
      <tbody id="receiptItems" class="text-sm">
        <!-- ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
      </tbody>
    </table>

    <!-- ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î -->
    <div class="text-right text-base font-bold text-green-700">
      ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô: <span id="receiptTotal">0.00</span> ‡∏ö‡∏≤‡∏ó
    </div>

    <!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
    <div class="text-right">
      <span id="receiptStatus" class="text-sm font-semibold px-3 py-1 rounded-full bg-blue-100 text-blue-800 inline-block">
        üì¶ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
      </span>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢ -->
    <div class="text-center text-xs text-gray-500 pt-4 border-t border-gray-200 italic">
      ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡πÅ‡∏°‡πà‡∏î‡∏≠‡∏ô‡πÇ‡∏≠‡∏ó‡∏≠‡∏õ üíõ<br/>
      ‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ üåæ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏£‡πà‡∏≠‡∏¢ ‡∏™‡πà‡∏á‡∏ï‡∏£‡∏á‡∏ñ‡∏∂‡∏á‡∏°‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì
    </div>
  </div>
</div>

  <script>
    let items = [];
    let orderCounter = 1;
    let isLoggedIn = false;

    // Login functions
    function showLoginModal() {
      document.getElementById('loginModal').classList.remove('hidden');
      document.getElementById('passwordInput').focus();
    }

    function hideLoginModal() {
      document.getElementById('loginModal').classList.add('hidden');
      document.getElementById('passwordInput').value = '';
    }

    function handlePasswordKeyPress(event) {
      if (event.key === 'Enter') {
        login();
      }
    }

    function login() {
      const password = document.getElementById('passwordInput').value;
      if (password === '1234') {
        isLoggedIn = true;
        hideLoginModal();
        showAdminDashboard();
        loadOrders();
      } else {
        alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        document.getElementById('passwordInput').value = '';
      }
    }

    function logout() {
      isLoggedIn = false;
      showMainForm();
    }

    function showAdminDashboard() {
      document.getElementById('mainOrderForm').classList.add('hidden');
      document.getElementById('receiptFullPage').classList.add('hidden');
      document.getElementById('adminDashboard').classList.remove('hidden');
      document.getElementById('loginBtn').classList.add('hidden');
      document.getElementById('logoutBtn').classList.remove('hidden');
    }

    function showMainForm() {
      document.getElementById('adminDashboard').classList.add('hidden');
      document.getElementById('mainOrderForm').classList.remove('hidden');
      document.getElementById('loginBtn').classList.remove('hidden');
      document.getElementById('logoutBtn').classList.add('hidden');
    }

    // Order management functions
    async function loadOrders() {
      try {
        const orders = await window.getOrdersFromFirebase();
        displayOrders(orders);
        calculateStats(orders);
      } catch (error) {
        console.error('Error loading orders:', error);
      }
    }

    function displayOrders(orders) {
      const ordersList = document.getElementById('ordersList');
      
      if (!orders || Object.keys(orders).length === 0) {
        ordersList.innerHTML = '<p class="text-gray-500 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå</p>';
        return;
      }

      const ordersArray = Object.entries(orders).map(([id, order]) => ({
        id,
        ...order
      }));

      // Sort by date (newest first)
      ordersArray.sort((a, b) => new Date(b.orderDate) - new Date(a.orderDate));

      ordersList.innerHTML = ordersArray.map(order => {
        const statusColor = getStatusColor(order.status || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£');
        const statusIcon = getStatusIcon(order.status || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£');
        
        return `
          <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50">
            <div class="flex justify-between items-start mb-3" onclick="showOrderDetails('${order.id}', ${JSON.stringify(order).replace(/"/g, '&quot;')})" style="cursor: pointer;">
              <div>
                <h3 class="font-semibold text-lg">${order.customer?.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}</h3>
                <p class="text-sm text-gray-500">${order.customer?.phone || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ö‡∏≠‡∏£‡πå'}</p>
                <p class="text-sm text-gray-600">${order.items?.length || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
              </div>
              <div class="text-right">
                <p class="font-bold text-green-600">${order.totalAmount?.toFixed(2) || '0.00'} ‡∏ö‡∏≤‡∏ó</p>
                <p class="text-sm text-gray-500">${new Date(order.orderDate).toLocaleString('th-TH')}</p>
              </div>
            </div>
            
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between pt-3 border-t border-gray-100 gap-3">
              <div class="flex items-center gap-2">
                <span class="text-sm font-medium text-gray-600">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</span>
                <span class="px-2 py-1 rounded-full text-xs font-medium ${statusColor}">
                  ${statusIcon} ${order.status || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'}
                </span>
              </div>
              
              <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 w-full sm:w-auto">
                <div class="flex items-center gap-2">
                  <select id="status-${order.id}" class="text-sm border border-gray-300 rounded px-2 py-1 focus:ring-1 focus:ring-blue-400">
                    <option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" ${(order.status || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£') === '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' ? 'selected' : ''}>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                    <option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á" ${order.status === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á' ? 'selected' : ''}>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</option>
                    <option value="‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß" ${order.status === '‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß' ? 'selected' : ''}>‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</option>
                    <option value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" ${order.status === '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' ? 'selected' : ''}>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
                  </select>
                  <button onclick="updateOrderStatus('${order.id}')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors whitespace-nowrap">
                    üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                  </button>
                </div>
                
                <div class="flex items-center gap-2">
                  <button onclick="editOrder('${order.id}', ${JSON.stringify(order).replace(/"/g, '&quot;')})" class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-1 rounded text-sm transition-colors whitespace-nowrap">
                    ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                  </button>
                  <button onclick="deleteOrder('${order.id}')" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors whitespace-nowrap">
                    üóëÔ∏è ‡∏•‡∏ö
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function getStatusColor(status) {
      switch(status) {
        case '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£': return 'bg-yellow-100 text-yellow-800';
        case '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á': return 'bg-blue-100 text-blue-800';
        case '‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß': return 'bg-green-100 text-green-800';
        case '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å': return 'bg-red-100 text-red-800';
        default: return 'bg-gray-100 text-gray-800';
      }
    }

    function getStatusIcon(status) {
      switch(status) {
        case '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£': return '‚è≥';
        case '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á': return 'üöö';
        case '‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß': return '‚úÖ';
        case '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å': return '‚ùå';
        default: return 'üì¶';
      }
    }

    async function updateOrderStatus(orderId) {
      const newStatus = document.getElementById(`status-${orderId}`).value;
      
      showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...', 'info');

      try {
        // Get current order data
        const orders = await window.getOrdersFromFirebase();
        const currentOrder = orders[orderId];
        
        if (!currentOrder) {
          showStatus('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå', 'error');
          return;
        }

        // Update order with new status
        const updatedOrder = {
          ...currentOrder,
          status: newStatus,
          lastModified: new Date().toISOString()
        };

        const success = await window.updateOrderInFirebase(orderId, updatedOrder);
        if (success) {
          loadOrders(); // Refresh the orders list
          showStatus(`‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô "${newStatus}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`, 'success');
        } else {
          showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', 'error');
        }
      } catch (error) {
        showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
      }
    }

    function calculateStats(orders) {
      if (!orders) {
        document.getElementById('totalRevenue').textContent = '0 ‡∏ö‡∏≤‡∏ó';
        document.getElementById('totalOrders').textContent = '0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
        document.getElementById('todayOrders').textContent = '0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
        return;
      }

      const ordersArray = Object.values(orders);
      const totalRevenue = ordersArray.reduce((sum, order) => sum + (order.totalAmount || 0), 0);
      const totalOrders = ordersArray.length;
      
      const today = new Date().toDateString();
      const todayOrders = ordersArray.filter(order => 
        new Date(order.orderDate).toDateString() === today
      ).length;

      document.getElementById('totalRevenue').textContent = `${totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó`;
      document.getElementById('totalOrders').textContent = `${totalOrders} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
      document.getElementById('todayOrders').textContent = `${todayOrders} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
    }

    function showOrderDetails(orderId, orderData) {
      const order = typeof orderData === 'string' ? JSON.parse(orderData) : orderData;
      const statusColor = getStatusColor(order.status || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£');
      const statusIcon = getStatusIcon(order.status || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£');
      
      const orderDetails = document.getElementById('orderDetails');
  orderDetails.innerHTML = `
<div class="relative overflow-hidden bg-white rounded-xl border p-4 sm:p-6 shadow-sm text-gray-800 space-y-6 font-sans">
  <!-- ‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥ -->
  <div class="absolute inset-0 flex items-center justify-center opacity-5 pointer-events-none select-none z-0">
    <h1 class="text-5xl font-bold rotate-12 text-gray-400 whitespace-nowrap">‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏î‡∏≠‡∏ô‡πÇ‡∏≠‡∏ó‡∏≠‡∏õ</h1>
  </div>

  <div class="relative z-10 space-y-4">
    <div class="text-center space-y-1">
      <h1 class="text-xl font-bold text-yellow-700">üçå ‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏î‡∏≠‡∏ô‡πÇ‡∏≠‡∏ó‡∏≠‡∏õ</h1>
      <p class="text-sm text-gray-600">‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</p>
      <p class="text-xs text-gray-500">${new Date(order.orderDate).toLocaleString('th-TH')}</p>
    </div>

    <div class="bg-yellow-50 p-4 rounded-xl shadow-sm border border-yellow-200 space-y-1 text-sm">
      <p><strong>üë§ ‡∏ä‡∏∑‡πà‡∏≠:</strong> ${order.customer?.name || '-'}</p>
      <p><strong>üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</strong> ${order.customer?.phone || '-'}</p>
      <p><strong>üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${order.customer?.address || '-'}</p>
    </div>

    <table class="w-full text-sm border-t border-b border-gray-300">
      <thead class="bg-yellow-100 text-gray-800">
        <tr>
          <th class="text-left py-2 px-2">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
          <th class="text-center py-2 px-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
          <th class="text-right py-2 px-2">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
        </tr>
      </thead>
      <tbody>
        ${order.items?.map(item => `
          <tr class="border-b border-gray-100">
            <td class="py-1 px-2">${item.name}${item.size ? ` (${item.size})` : ''}</td>
            <td class="text-center py-1 px-2">${item.qty}</td>
            <td class="text-right py-1 px-2">${item.total?.toFixed(2) || '0.00'}</td>
          </tr>
        `).join('') || '<tr><td colspan="3" class="text-center py-2 text-gray-400 italic">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</td></tr>'}
      </tbody>
    </table>

    <div class="text-right text-base font-bold text-green-700">
      ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô: ${order.totalAmount?.toFixed(2) || '0.00'} ‡∏ö‡∏≤‡∏ó
    </div>

    <div class="text-right text-sm font-semibold text-blue-600">
      üì¶ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${order.status || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'}
    </div>

    ${!isLoggedIn ? `
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 text-center text-sm text-blue-700">
        üëÅÔ∏è ‡πÇ‡∏´‡∏°‡∏î‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        <div class="text-xs text-blue-500 mt-1">
          ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        </div>
      </div>
    ` : ''}
  </div>
</div>
`;

      // Add action buttons only for logged-in admin
      const orderActions = document.getElementById('orderActions');
      if (isLoggedIn) {
        orderActions.innerHTML = `
  <button onclick="editOrder('${orderId}', ${JSON.stringify(order).replace(/"/g, '&quot;')})" class="flex-1 bg-orange-600 hover:bg-orange-700 text-white py-2 px-4 rounded-lg text-sm">
    ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
  </button>
  <button onclick="deleteOrder('${orderId}')" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg text-sm">
    üóëÔ∏è ‡∏•‡∏ö
  </button>
  <button onclick="printOrderModal()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg text-sm">
    üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå
  </button>
  <button onclick="downloadOrderImage('${orderId}')" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg text-sm">
    üì∑ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
  </button>
`;
      } else {
        orderActions.innerHTML = `
          <button onclick="hideOrderModal()" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg text-sm">
            ‡∏õ‡∏¥‡∏î
          </button>
        `;
      }
      
      document.getElementById('orderModal').classList.remove('hidden');
    }

    function hideOrderModal() {
      document.getElementById('orderModal').classList.add('hidden');
    }

    function hideEditOrderModal() {
      document.getElementById('editOrderModal').classList.add('hidden');
    }

    function hideEditCurrentOrderModal() {
      document.getElementById('editCurrentOrderModal').classList.add('hidden');
    }

    function refreshOrders() {
      loadOrders();
    }

    // Edit current order before saving
    function showEditCurrentOrder() {
      const customerName = document.getElementById('customerName').value.trim();
      const customerPhone = document.getElementById('customerPhone').value.trim();
      const customerAddress = document.getElementById('customerAddress').value.trim();

      if (items.length === 0) {
        showStatus('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', 'error');
        return;
      }

      const editForm = document.getElementById('editCurrentOrderForm');
      editForm.innerHTML = `
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
            <input id="editCurrentCustomerName" value="${customerName}" class="w-full border border-gray-300 p-2 rounded-lg" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
            <input id="editCurrentCustomerPhone" value="${customerPhone}" class="w-full border border-gray-300 p-2 rounded-lg" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
            <textarea id="editCurrentCustomerAddress" class="w-full border border-gray-300 p-2 rounded-lg" rows="2">${customerAddress}</textarea>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
            <div id="editCurrentItems" class="space-y-2 max-h-40 overflow-y-auto">
              ${items.map((item, index) => `
                <div class="flex items-center gap-2 p-2 border rounded">
                  <input value="${item.name}" onchange="updateCurrentItem(${index}, 'name', this.value)" class="flex-1 text-sm border-0 bg-transparent" />
                  <input value="${item.size}" onchange="updateCurrentItem(${index}, 'size', this.value)" class="w-16 text-sm border-0 bg-transparent" placeholder="‡∏Ç‡∏ô‡∏≤‡∏î" />
                  <input type="number" value="${item.qty}" onchange="updateCurrentItem(${index}, 'qty', parseInt(this.value))" class="w-16 text-sm border-0 bg-transparent" />
                  <input type="number" value="${item.price}" onchange="updateCurrentItem(${index}, 'price', parseFloat(this.value))" class="w-20 text-sm border-0 bg-transparent" step="0.01" />
                  <button onclick="removeCurrentItem(${index})" class="text-red-500 hover:text-red-700 text-sm">üóëÔ∏è</button>
                </div>
              `).join('')}
            </div>
          </div>
          
          <div class="flex gap-2">
            <button onclick="saveCurrentOrderChanges()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg">
              üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
            </button>
            <button onclick="hideEditCurrentOrderModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 rounded-lg">
              ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
            </button>
          </div>
        </div>
      `;

      document.getElementById('editCurrentOrderModal').classList.remove('hidden');
    }

    function updateCurrentItem(index, field, value) {
      if (field === 'qty' || field === 'price') {
        items[index][field] = value;
        items[index].total = items[index].qty * items[index].price;
      } else {
        items[index][field] = value;
      }
      updateItemList();
    }

    function removeCurrentItem(index) {
      items.splice(index, 1);
      updateItemList();
      showEditCurrentOrder(); // Refresh the edit form
    }

    function saveCurrentOrderChanges() {
      const newName = document.getElementById('editCurrentCustomerName').value.trim();
      const newPhone = document.getElementById('editCurrentCustomerPhone').value.trim();
      const newAddress = document.getElementById('editCurrentCustomerAddress').value.trim();

      if (!newName || !newPhone) {
        showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', 'error');
        return;
      }

      document.getElementById('customerName').value = newName;
      document.getElementById('customerPhone').value = newPhone;
      document.getElementById('customerAddress').value = newAddress;

      hideEditCurrentOrderModal();
      showStatus('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
    }

    // Edit saved order
    function editOrder(orderId, orderData) {
      const order = typeof orderData === 'string' ? JSON.parse(orderData) : orderData;
      
      const editForm = document.getElementById('editOrderForm');
      editForm.innerHTML = `
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
            <input id="editCustomerName" value="${order.customer?.name || ''}" class="w-full border border-gray-300 p-2 rounded-lg" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
            <input id="editCustomerPhone" value="${order.customer?.phone || ''}" class="w-full border border-gray-300 p-2 rounded-lg" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
            <textarea id="editCustomerAddress" class="w-full border border-gray-300 p-2 rounded-lg" rows="2">${order.customer?.address || ''}</textarea>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
            <div id="editItems" class="space-y-2 max-h-40 overflow-y-auto">
              ${order.items?.map((item, index) => `
                <div class="flex items-center gap-2 p-2 border rounded">
                  <input value="${item.name}" onchange="updateEditItem(${index}, 'name', this.value)" class="flex-1 text-sm border-0 bg-transparent" />
                  <input value="${item.size || ''}" onchange="updateEditItem(${index}, 'size', this.value)" class="w-16 text-sm border-0 bg-transparent" placeholder="‡∏Ç‡∏ô‡∏≤‡∏î" />
                  <input type="number" value="${item.qty}" onchange="updateEditItem(${index}, 'qty', parseInt(this.value))" class="w-16 text-sm border-0 bg-transparent" />
                  <input type="number" value="${item.price}" onchange="updateEditItem(${index}, 'price', parseFloat(this.value))" class="w-20 text-sm border-0 bg-transparent" step="0.01" />
                  <button onclick="removeEditItem(${index})" class="text-red-500 hover:text-red-700 text-sm">üóëÔ∏è</button>
                </div>
              `).join('') || '<p class="text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>'}
            </div>
          </div>
          
          <div class="flex gap-2">
            <button onclick="saveOrderChanges('${orderId}')" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg">
              üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
            </button>
            <button onclick="hideEditOrderModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 rounded-lg">
              ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
            </button>
          </div>
        </div>
      `;

      // Store current editing order
      window.currentEditingOrder = { ...order };
      document.getElementById('editOrderModal').classList.remove('hidden');
    }

    function updateEditItem(index, field, value) {
      if (field === 'qty' || field === 'price') {
        window.currentEditingOrder.items[index][field] = value;
        window.currentEditingOrder.items[index].total = window.currentEditingOrder.items[index].qty * window.currentEditingOrder.items[index].price;
      } else {
        window.currentEditingOrder.items[index][field] = value;
      }
    }

    function removeEditItem(index) {
      window.currentEditingOrder.items.splice(index, 1);
      editOrder('temp', window.currentEditingOrder); // Refresh the edit form
    }

    async function saveOrderChanges(orderId) {
      const newName = document.getElementById('editCustomerName').value.trim();
      const newPhone = document.getElementById('editCustomerPhone').value.trim();
      const newAddress = document.getElementById('editCustomerAddress').value.trim();

      if (!newName || !newPhone) {
        showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', 'error');
        return;
      }

      const updatedOrder = {
        ...window.currentEditingOrder,
        customer: {
          name: newName,
          phone: newPhone,
          address: newAddress
        },
        totalAmount: window.currentEditingOrder.items.reduce((sum, item) => sum + item.total, 0),
        lastModified: new Date().toISOString()
      };

      showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç...', 'info');

      try {
        const success = await window.updateOrderInFirebase(orderId, updatedOrder);
        if (success) {
          hideEditOrderModal();
          hideOrderModal();
          loadOrders();
          showStatus('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
        } else {
          showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå', 'error');
        }
      } catch (error) {
        showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
      }
    }

    async function deleteOrder(orderId) {
      if (!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
        return;
      }

      showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå...', 'info');

      try {
        const success = await window.deleteOrderFromFirebase(orderId);
        if (success) {
          hideOrderModal();
          loadOrders();
          showStatus('‡∏•‡∏ö‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
        } else {
          showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå', 'error');
        }
      } catch (error) {
        showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
      }
    }

    // Original ordering system functions
    function addItem() {
      const name = document.getElementById('productName').value.trim();
      const size = document.getElementById('productSize').value.trim();
      const qty = parseInt(document.getElementById('productQty').value);
      const price = parseFloat(document.getElementById('productPrice').value);

      if (!name || !qty || !price || qty <= 0 || price < 0) {
        showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
        return;
      }

      const item = {
        id: Date.now(),
        name: name,
        size: size || '',
        qty: qty,
        price: price,
        total: qty * price
      };

      items.push(item);
      updateItemList();
      clearProductForm();
      showStatus('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
    }

    function removeItem(id) {
      items = items.filter(item => item.id !== id);
      updateItemList();
      showStatus('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
    }

    function updateItemList() {
      const itemList = document.getElementById('itemList');
      const totalQty = document.getElementById('totalQty');
      const totalPrice = document.getElementById('totalPrice');

      if (items.length === 0) {
        itemList.innerHTML = '<li class="text-center py-8 text-gray-500 italic bg-gray-50 rounded-xl">üõí ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</li>';
        totalQty.textContent = '0';
        totalPrice.textContent = '0.00';
        return;
      }

      itemList.innerHTML = items.map(item => `
        <li class="bg-gradient-to-r from-gray-50 to-gray-100 p-4 rounded-xl border-l-4 border-yellow-400 shadow-sm">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <div class="font-bold text-gray-800 text-base mb-1">
                üçØ ${item.name}
                ${item.size ? `<span class="text-sm text-gray-600 font-normal">(${item.size})</span>` : ''}
              </div>
              <div class="text-sm text-gray-600 mb-2">
                ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: <span class="font-semibold text-blue-600">${item.qty}</span> √ó 
                <span class="font-semibold text-green-600">${item.price.toFixed(2)}</span> ‡∏ö‡∏≤‡∏ó
              </div>
            </div>
            <div class="text-right ml-4">
              <div class="font-bold text-lg text-green-600 mb-2">${item.total.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
              <button onclick="removeItem(${item.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-sm transition-all duration-200 transform hover:scale-105 active:scale-95">
                üóëÔ∏è ‡∏•‡∏ö
              </button>
            </div>
          </div>
        </li>
      `).join('');

      const totalItems = items.reduce((sum, item) => sum + item.qty, 0);
      const totalAmount = items.reduce((sum, item) => sum + item.total, 0);

      totalQty.textContent = totalItems;
      totalPrice.textContent = totalAmount.toFixed(2);
    }

    function clearProductForm() {
      document.getElementById('productName').value = '';
      document.getElementById('productSize').value = '';
      document.getElementById('productQty').value = '';
      document.getElementById('productPrice').value = '';
    }

    function clearAll() {
      if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
        items = [];
        document.getElementById('customerName').value = '';
        document.getElementById('customerPhone').value = '';
        document.getElementById('customerAddress').value = '';
        clearProductForm();
        updateItemList();
        document.getElementById('receiptFullPage').classList.add('hidden');
        showStatus('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
      }
    }

    function generateReceipt() {
      const customerName = document.getElementById('customerName').value.trim();
      const customerPhone = document.getElementById('customerPhone').value.trim();
      const customerAddress = document.getElementById('customerAddress').value.trim();

      if (!customerName || !customerPhone || items.length === 0) {
        showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', 'error');
        return;
      }

      // Update receipt content
      document.getElementById('receiptDate').textContent = new Date().toLocaleString('th-TH');
      document.getElementById('receiptCustomerName').textContent = customerName;
      document.getElementById('receiptCustomerPhone').textContent = customerPhone;
      document.getElementById('receiptCustomerAddress').textContent = customerAddress;

      const receiptItems = document.getElementById('receiptItems');
receiptItems.innerHTML = items.map(item => `
  <tr class="border-b border-gray-100">
    <td class="py-1 px-2">${item.name}${item.size ? ` (${item.size})` : ''}</td>
    <td class="text-center py-1 px-2">${item.qty}</td>
    <td class="text-right py-1 px-2">${item.total.toFixed(2)}</td>
  </tr>
`).join('');

      const totalAmount = items.reduce((sum, item) => sum + item.total, 0);
      document.getElementById('receiptTotal').textContent = totalAmount.toFixed(2);

      // Show default status for new orders
      document.getElementById('receiptStatus').textContent = '‚è≥ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£';

      document.getElementById('receiptFullPage').classList.remove('hidden');
      document.getElementById('receiptFullPage').scrollIntoView({ behavior: 'smooth' });
      
      showStatus('‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
    }

    async function saveOrder() {
      const customerName = document.getElementById('customerName').value.trim();
      const customerPhone = document.getElementById('customerPhone').value.trim();
      const customerAddress = document.getElementById('customerAddress').value.trim();

      if (!customerName || !customerPhone || items.length === 0) {
        showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', 'error');
        return;
      }

      const order = {
        customer: {
          name: customerName,
          phone: customerPhone,
          address: customerAddress
        },
        items: items,
        totalAmount: items.reduce((sum, item) => sum + item.total, 0),
        orderDate: new Date().toISOString(),
        status: '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'
      };

      showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå...', 'info');

      try {
        const success = await window.saveOrderToFirebase(order);
        if (success) {
          orderCounter++;
          showStatus('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
        } else {
          showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå', 'error');
        }
      } catch (error) {
        showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
      }
    }

    function printReceipt() {
      const receiptElement = document.getElementById('receiptFullPage');
      if (receiptElement.classList.contains('hidden')) {
        showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå', 'error');
        return;
      }
      window.print();
    }
    
 // ‚úÖ ‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
function printOrderModal() {
  const orderModal = document.getElementById('orderModal');
  const orderDetails = document.getElementById('orderDetails');

  if (!orderModal || orderModal.classList.contains('hidden')) {
    showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå', 'error');
    return;
  }

  const printWindow = window.open('', '_blank');
  printWindow.document.write(`
    <html>
      <head>
        <title>‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</title>
        <style>
          @page {
            size: A4 portrait;
            margin: 1.5cm;
          }

          body {
            font-family: 'Sarabun', sans-serif;
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            background: #f9f9f9;
          }

          .receipt {
            max-width: 700px;
            margin: auto;
            background: #fff;
            padding: 30px 40px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
            position: relative;
          }

          h2 {
            text-align: center;
            color: #00695c;
            margin-bottom: 5px;
          }

          .receipt-header {
            text-align: center;
            margin-bottom: 20px;
          }

          .receipt-info p {
            margin: 5px 0;
          }

          table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
          }

          th, td {
            padding: 8px 10px;
            border-bottom: 1px dashed #ccc;
            text-align: left;
          }

          th {
            background-color: #e0f2f1;
            color: #004d40;
          }

          tr:last-child td {
            border-bottom: none;
          }

          .total {
            margin-top: 15px;
            text-align: right;
            font-size: 18px;
            font-weight: bold;
            color: #d84315;
          }

          .footer {
            margin-top: 40px;
            text-align: center;
            font-size: 13px;
            color: #777;
            font-style: italic;
          }

          .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 48px;
            color: rgba(0, 0, 0, 0.05);
            pointer-events: none;
            z-index: 0;
            white-space: nowrap;
          }

          @media print {
            body {
              -webkit-print-color-adjust: exact;
              print-color-adjust: exact;
            }
          }
        </style>
      </head>
      <body>
        <div class="receipt">
          <div class="watermark">‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏î‡∏≠‡∏ô‡πÇ‡∏≠‡∏ó‡∏≠‡∏õ</div>
          ${orderDetails.innerHTML}
        </div>
      </body>
    </html>
  `);
  printWindow.document.close();
  printWindow.focus();
  printWindow.print();
}

// ‚úÖ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
function downloadOrderImage(orderId) {
  const orderDetails = document.getElementById('orderDetails');

  if (!orderDetails || orderDetails.innerHTML.trim() === '') {
    showStatus('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ', 'error');
    return;
  }

  setTimeout(() => {
    html2canvas(orderDetails, { scale: 2 }).then(canvas => {
      const link = document.createElement('a');
      link.download = `‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à_${orderId}.png`;
      link.href = canvas.toDataURL();
      link.click();
    });
  }, 300);
}
    
    function showStatus(message, type) {
      const statusElement = document.getElementById('statusMessage');
      statusElement.textContent = message;
      statusElement.className = `p-4 rounded-lg text-center font-semibold ${
        type === 'success' ? 'bg-green-100 text-green-800' :
        type === 'error' ? 'bg-red-100 text-red-800' :
        'bg-blue-100 text-blue-800'
      }`;
      statusElement.classList.remove('hidden');
      
      setTimeout(() => {
        statusElement.classList.add('hidden');
      }, 3000);
    }

    // Customer order search functionality
    async function searchOrders() {
      const searchTerm = document.getElementById('searchInput').value.trim();
      
      if (!searchTerm) {
        showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå', 'error');
        return;
      }

      showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå...', 'info');

      try {
        const orders = await window.getOrdersFromFirebase();
        
        if (!orders || Object.keys(orders).length === 0) {
          displaySearchResults([]);
          showStatus('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', 'error');
          return;
        }

        // Filter orders by customer name or phone
        const filteredOrders = Object.entries(orders)
          .filter(([id, order]) => {
            const customerName = (order.customer?.name || '').toLowerCase();
            const customerPhone = (order.customer?.phone || '').toLowerCase();
            const searchLower = searchTerm.toLowerCase();
            
            return customerName.includes(searchLower) || customerPhone.includes(searchLower);
          })
          .map(([id, order]) => ({ id, ...order }));

        displaySearchResults(filteredOrders);
        
        if (filteredOrders.length === 0) {
          showStatus('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', 'error');
        } else {
          showStatus(`‡∏û‡∏ö‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå ${filteredOrders.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, 'success');
        }
      } catch (error) {
        showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', 'error');
        console.error('Search error:', error);
      }
    }

    function displaySearchResults(orders) {
      const searchResults = document.getElementById('searchResults');
      const searchResultsList = document.getElementById('searchResultsList');
      const searchCount = document.getElementById('searchCount');
      
      if (orders.length === 0) {
        searchResults.classList.add('hidden');
        return;
      }

      // Update search count
      searchCount.textContent = `${orders.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;

      // Sort by date (newest first)
      orders.sort((a, b) => new Date(b.orderDate) - new Date(a.orderDate));

      searchResultsList.innerHTML = orders.map(order => {
        const statusColor = getStatusColor(order.status || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£');
        const statusIcon = getStatusIcon(order.status || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£');
        
        return `
          <div class="bg-white border-2 border-orange-100 rounded-xl p-4 hover:border-orange-300 hover:shadow-md cursor-pointer transition-all duration-200 transform hover:scale-102" onclick="showOrderDetails('${order.id}', ${JSON.stringify(order).replace(/"/g, '&quot;')})">
            <div class="flex justify-between items-start mb-3">
              <div>
                <h3 class="font-bold text-lg text-gray-800">${order.customer?.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}</h3>
                <p class="text-sm text-gray-600 flex items-center gap-1">
                  <span>üì±</span> ${order.customer?.phone || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ö‡∏≠‡∏£‡πå'}
                </p>
                <p class="text-sm text-gray-600 flex items-center gap-1">
                  <span>üõí</span> ${order.items?.length || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                </p>
              </div>
              <div class="text-right">
                <p class="font-bold text-xl text-green-600">${order.totalAmount?.toFixed(2) || '0.00'} ‡∏ö‡∏≤‡∏ó</p>
                <p class="text-xs text-gray-500">${new Date(order.orderDate).toLocaleString('th-TH')}</p>
              </div>
            </div>
            
            <div class="flex items-center justify-center pt-3 border-t border-orange-100">
              <span class="px-4 py-2 rounded-full text-sm font-bold ${statusColor} shadow-sm">
                ${statusIcon} ${order.status || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'}
              </span>
            </div>
          </div>
        `;
      }).join('');

      searchResults.classList.remove('hidden');
    }

    function handleSearchKeyPress(event) {
      if (event.key === 'Enter') {
        searchOrders();
      }
    }

    function clearSearch() {
      document.getElementById('searchInput').value = '';
      document.getElementById('searchResults').classList.add('hidden');
      showStatus('‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
    }

    // Initialize
    updateItemList();
  </script>

<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96406bd4f24a26dd',t:'MTc1MzMyODY4OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
